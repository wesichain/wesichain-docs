---
import { getCollection } from 'astro:content';

const docs = await getCollection('docs', ({ data }) => !data.draft);

// Group docs by their group field
const groupedDocs = docs.reduce((acc, doc) => {
  const group = doc.data.group || 'Other';
  if (!acc[group]) acc[group] = [];
  acc[group].push(doc);
  return acc;
}, {} as Record<string, typeof docs>);

// Sort docs within each group by order
Object.keys(groupedDocs).forEach(group => {
  groupedDocs[group].sort((a, b) => (a.data.order || 999) - (b.data.order || 999));
});

const currentPath = Astro.url.pathname;
---

<aside class="hidden lg:block w-64 shrink-0">
  <nav class="sticky top-20 h-[calc(100vh-6rem)] overflow-y-auto pr-4">
    {Object.entries(groupedDocs).map(([group, items]) => (
      <div class="mb-6">
        <h3 class="mb-2 px-3 text-xs font-semibold uppercase tracking-wider text-neutral-500">
          {group}
        </h3>
        <ul class="space-y-1">
          {items.map(doc => {
            const href = `/docs/${doc.slug}`;
            const isActive = currentPath === href || currentPath.startsWith(`${href}/`);
            return (
              <li>
                <a
                  href={href}
                  class:list={[
                    'block rounded-md px-3 py-2 text-sm transition-colors',
                    isActive
                      ? 'bg-rust-600/10 text-rust-500 font-medium'
                      : 'text-neutral-400 hover:bg-neutral-900 hover:text-white'
                  ]}
                >
                  {doc.data.title}
                </a>
              </li>
            );
          })}
        </ul>
      </div>
    ))}
  </nav>
</aside>
